<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>WordWave | Home</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Master Urdu vocabulary with interactive flashcards, quizzes, and progress tracking">
    <meta name="theme-color" content="#ffffff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="WordWave">
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS Splash Screen (fallback to icon) -->
    <link rel="apple-touch-startup-image" href="icons/icon-512x512.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    
    <style>
        /* Notification Connection Indicator */
        .notification-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            position: relative;
        }

        .notification-indicator.connected {
            background-color: #28a745;
            animation: pulse-green 2s infinite;
        }

        .notification-indicator.disconnected {
            background-color: #dc3545;
            animation: pulse-red 2s infinite;
        }

        @keyframes pulse-green {
            0% {
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
            }
            70% {
                box-shadow: 0 0 0 6px rgba(40, 167, 69, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
            }
        }

        @keyframes pulse-red {
            0% {
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);
            }
            70% {
                box-shadow: 0 0 0 6px rgba(220, 53, 69, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);
            }
        }
    </style>
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
    
    <!-- Fixed: Removed extra spaces in CDN links -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="styles/custom.css" rel="stylesheet">
    <link href="styles/animations.css" rel="stylesheet">
    <link href="styles/native.css" rel="stylesheet">
    
    <script>
        // Load OneSignal asynchronously
        (function() {
            const script = document.createElement('script');
            script.src = 'https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js';
            script.async = true;
            script.onload = function() {
                console.log('✅ OneSignal loaded successfully');
                window.oneSignalLoaded = true;
            };
            script.onerror = function() {
                console.error('❌ OneSignal failed to load from CDN');
                window.oneSignalLoaded = false;
            };
            document.head.appendChild(script);
        })();
    </script>
</head>
<body>
    <!-- Main Content -->
    <main class="main-content">
        <!-- Update Available Banner -->
        <div id="updateBanner" class="d-none" style="
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 12px 20px;
            margin: 0;
            border: none;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2);
        ">
            <div class="d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center">
                    <div style="
                        background: rgba(255,255,255,0.2);
                        border-radius: 50%;
                        width: 32px;
                        height: 32px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        margin-right: 12px;
                    ">
                        <i class="bi bi-arrow-up-circle-fill" style="font-size: 16px;"></i>
                    </div>
                    <div>
                        <div style="font-weight: 600; font-size: 14px; margin-bottom: 2px;">New Update Available</div>
                        <div style="font-size: 12px; opacity: 0.9;">Tap to install the latest version</div>
                    </div>
                </div>
                <button type="button" class="btn btn-light btn-sm" id="installUpdateFromBanner" style="
                    font-weight: 600;
                    font-size: 12px;
                    padding: 6px 16px;
                    border-radius: 20px;
                    border: none;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                ">
                    Install
                </button>
            </div>
        </div>
        
        <div class="container py-4">
            <!-- Word of the Day -->
            <div class="card border-0 shadow-sm mb-4 word-of-day-gradient">
                <div class="card-body py-3">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="flex-grow-1">
                            <div class="small text-white-50 mb-1">Word of the Day</div>
                            <div class="h5 mb-0 text-white" id="dailyWordEnglish">Loading...</div>
                            <div class="text-white-75" id="dailyWordUrdu">...</div>
                        </div>
                        <div class="d-flex gap-2">
                            <button id="speakDailyWord" class="btn btn-sm btn-light">
                                <i class="bi bi-volume-up"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Learning Level -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body">
                    <h2 class="h6 text-muted mb-3">Learning Level</h2>
                    <div id="difficultyLevels" class="d-flex justify-content-center gap-3 mb-3">
                        <!-- Difficulty badges will be populated here -->
                    </div>
                    <div id="levelProgress" class="text-center">
                        <!-- Level progress info will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Overall Progress -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body py-3">
                    <h2 class="h6 text-muted mb-3">Your Learning Progress</h2>
                    
                    <!-- Compact Progress Grid -->
                    <div class="row g-2">
                        <div class="col-4">
                            <div class="text-center p-2 bg-light rounded-2">
                                <i class="bi bi-book text-primary fs-5 mb-1"></i>
                                <div class="d-flex justify-content-center align-items-center gap-1">
                                    <span class="h6 mb-0 text-success" id="homeWordsLearned">0</span>
                                    <span class="small text-muted">/</span>
                                    <span class="small text-warning" id="homeWordsReview">0</span>
                                </div>
                                <div class="small text-muted" style="font-size: 0.7rem;">Words</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="text-center p-2 bg-light rounded-2">
                                <i class="bi bi-chat-text text-primary fs-5 mb-1"></i>
                                <div class="d-flex justify-content-center align-items-center gap-1">
                                    <span class="h6 mb-0 text-success" id="homeSentencesLearned">0</span>
                                    <span class="small text-muted">/</span>
                                    <span class="small text-warning" id="homeSentencesReview">0</span>
                                </div>
                                <div class="small text-muted" style="font-size: 0.7rem;">Sentences</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="text-center p-2 bg-light rounded-2">
                                <i class="bi bi-question-circle text-secondary fs-5 mb-1"></i>
                                <div class="h6 mb-0 text-secondary" id="homeQuizzesTaken">0</div>
                                <div class="small text-muted" style="font-size: 0.7rem;">Quizzes</div>
                            </div>
                        </div>
                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </main>

    <script src="js/data.js"></script>
    <script src="js/state.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/app.js"></script>
    <script src="js/pwa.js"></script>
    <script src="components/header/header.js"></script>
    <script src="components/sidebar/sidebar.js"></script>
    <script src="components/bottom-nav/bottom-nav.js"></script>
    <script>
        // Initialize header with home page content
        initHeader({
            title: 'WordWave'
        });

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                        
                        // Android Chrome fix: Force update check
                        if (navigator.userAgent.includes('Android')) {
                            registration.update();
                        }
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
                
                // Listen for update detection messages
                navigator.serviceWorker.addEventListener('message', event => {
                    console.log('📨 Received SW message:', event.data);
                    
                    if (event.data && event.data.type === 'UPDATE_DETECTED') {
                        console.log('🔄 Update detected:', event.data.version);
                        
                        // Set persistent localStorage flag
                        localStorage.setItem('wordwave_update_available', 'true');
                        localStorage.setItem('wordwave_update_version', event.data.version);
                        
                        console.log('✅ Update flag set in localStorage');
                    }
                });
            });
        }
    </script>
</body>
</html>